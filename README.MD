# Агенты LLM для прогнозирования общественного мнения о центральных банках

![](images\sfg.PNG "Описание архитектуры")


Данный репозиторий содержит код для фреймворка по созданию вирутальной фокус-группы и запуска дискусии определённого документа 

# Старт 

## Установка 

Для начала работы необходимо создать виртуальную среду и установить следующие библиотеки:
- transformers>=4.40.0
- torch>=2.1.2

Также необходимо создать аккаунт на [Yandex Cloud](https://yandex.cloud/ru?utm_referrer=https%3A%2F%2Fwww.google.com%2F) и создать API ключ для отправки запросов на YandexGPT (в качестве альтернативы можно использовать и другие модели через другие ресурсы, например через [OpenRouter](https://openrouter.ai/))

## Извлечение параметров аватаров

Для получения параметров аватаров необходимо подать текстовые версии интервью большим языковым моделям. В текущем пайплайне аватары имеют следющие параметры:

```
{
  "name": "Angelina",
  "age": 38,
  "profession": "Банковский служащий",
  "sentiment": 0.65,
  "traits": "Прагматичная, критичная, заботящаяся о семье",
  "concerns": "Отрыв цен от зарплат, недоступность жилья, рост цен на продукты",
  "key_phrases": "Остановите рост цен, снизите ставки",
  "communication_style": "Эмоциональные сравнения, примеры из семейного бюджета",
  "economic_view": "Фокусируется на покупательной способности семьи",
  "trust_in_institutions": 0.7,
  "knowledge_level": "Практический (работа в банковской сфере)",
  "financial_behavior": "Планирует крупные покупки с учетом сезонных изменений цен",
  "policy_priority": "Снижение ставок по кредитам, контроль цен на продукты",
  "cb_functions_understanding": "Установка ставок, регулирование банков, борьба с инфляцией",
  "cb_perception": "Признает усилия ЦБ в сложных условиях, но ждет более ощутимых результатов",
  "cb_trust_factors": "Конкретные обещания и их выполнение",
  "information_sources": "Новостные ленты, интернет-поисковики",
  "emotional_tone": "Обеспокоенный, критичный с элементами надежды"
}
```

## Сохранение полученных параметров

Полученные параметры аватаров сохрянются в виде json файлов в папку `params`

## Создание LLM агенты

С помощью класса Agent из скрипта `main.py` создаются LLM агенты из имеющихся json файлов

 
## Создание фокус-группы и калибровка LLM агентов

Прежде чем начать эксперимнты, необходимо произвести калибровку имеющихся LLM агентов: 

1. Первым шагом необходимо собрать несколько документов в txt формате, которые будут использоваться для калибровки. Можно использовать уже имеющиеся документы из файла `calibration.zip` либо использовать другие документы.
2. Далее создается класс `FocusGroup`, в который передаются следующие важные параметры:
   - **avatars_path**: путь к json файлам с параметрами аватаров
   - **api_key_agent**: API ключ для отправки запросов
   - **model_name_agent**: название используемой модели
   - **iterations**: кол-во итераций для одного вопроса в рамках дискусии
3. Затем необходимо запустить метод `calibrate_all` для созданного класса фокус группы, предварительно указав путь к используемым документам через аргумент `calibration_path`

Результаты калибровки сохраняются в файл `calibration_results.json`

 
## Проведение интервью

Дискусиия выполняется в слежующем формате:

![](images\discussion.PNG "Процесс дискусии с синтетической фокус-группой")

1. Обсуждаемый документ, а также список вопросов необходимо сохранить в файле в txt формате
2. Процесс дискусии для созданной группы запускается с помощью метода `start_dialog_auto`, куда подается обсуждаемый докмуент и список вопросов (также необходимо задать путь к ним через параметр `questions_file`)
3. Также пользователь может менять параметр **iterations** для фокус-группы (по умолчанию стоит 2)

Результаты дискусии сохранеятся в файл `result.txt`, результаты изменения параметра **trust_in_institutions** (доверия к институту) сохраняется в файл `trust_history.json`. Для наглядной визуализации имзенени этого параметра необходимо запустить скрипт `visualize.py`, предварительно указав путь к нужному json файлу.